## BeanFactory 源码

```java
public interface BeanFactory {


    // 对 FactoryBean 的转义, 提供 FactoryBean 的方式
    // 如果使用 bean 的名字检索 FactoryBean 只会得到工厂生成的对象
    // 如果需要得到工厂本身,需要 "&" + BeanID
	String FACTORY_BEAN_PREFIX = "&";
    
    // 根据 Bean 的名字从容器中获取 bean 实例
	Object getBean(String name) throws BeansException;

    // 按照类型获取 bean 实例
	<T> T getBean(String name, Class<T> requiredType) throws BeansException;

	// 
	Object getBean(String name, Object... args) throws BeansException;


	<T> T getBean(Class<T> requiredType) throws BeansException;

	<T> T getBean(Class<T> requiredType, Object... args) throws BeansException;

	<T> ObjectProvider<T> getBeanProvider(Class<T> requiredType);

	<T> ObjectProvider<T> getBeanProvider(ResolvableType requiredType);

	boolean containsBean(String name);

    // Bean 是否为单例, 默认为单例模式
	boolean isSingleton(String name) throws NoSuchBeanDefinitionException;


	boolean isPrototype(String name) throws NoSuchBeanDefinitionException;


	boolean isTypeMatch(String name, ResolvableType typeToMatch) throws NoSuchBeanDefinitionException;


	boolean isTypeMatch(String name, Class<?> typeToMatch) throws NoSuchBeanDefinitionException;


    // 获取 bean 的类
	@Nullable
	Class<?> getType(String name) throws NoSuchBeanDefinitionException;

	@Nullable
	Class<?> getType(String name, boolean allowFactoryBeanInit) throws NoSuchBeanDefinitionException;

    // 获取 bean 的别名数组
	String[] getAliases(String name);

}
```

## 简单容器

<center><img src="https://ning-wang.oss-cn-beijing.aliyuncs.com/blog-imags/20210415161002.png" alt="image-20210415161002173"  /></center>

* `ListableBeanFactory` : 支持以列表方式获取 bean 实例

* `HierarchicalBeanFactory` : 支持继承关系的 `BeanFactory`
* `AutowireCapableBeanFactory`: 支持自动注入的 `BeanFactory`
* `ConfigurableListableBeanFactory`:  提供能够修改添加  `BeanDefinition` 的功能
* `DefaultListableBeanFactory`: 第一个可以独立运行的 `BeanFactory`, 集成全部的 `BeanFactory` 的功能

> 其有一个关键属性
>
> ```java
> /**
> * 存储全部的 beanDefinition
> */
> private final Map<String, BeanDefinition> beanDefinitionMap = new ConcurrentHashMap<>(256);
> ```

## 高级容器

<center><img src="C:\Users\PC\AppData\Roaming\Typora\typora-user-images\image-20210415162446451.png" alt="image-20210415162446451"  /></center>

* `ApplicationContext` 是高级容器接口, 是面向用户提供的容器接口
* 基于 XML 配置的容器
  * `FileSystemXmlApplicationContext`: 从文件系统中加载配置
  * `ClassPathXmlApplicationContext`: 从 classpath 加载配置 
  * `XmlWebApplicationContext`: 用于 Web 应用程序的容器
* 基于注解的容器
  * `AnnotationConfigServletWebServerApplicationContext`:  Spring boot 提供的 Web 容器上下文
  * `AnnotationConfiReactiveWebServerApplicationContext`: 响应式编程容器上下文
  * `AnnotationConfigApplicationContext`: 普通的非 Web 容器上下文



容器共有功能 `refresh()`, 该函数提供一下功能

* 容器初始化,配置解析
* `BeanFactoryPostProcessor` 和 `BeanPostProcessor` 的注册和激活
* 国际化配置

<strong>`AbstractApplicationContext` 是 Spring IOC 的核心上下文实现类, 他负责了 `refresh` 的实现</strong>