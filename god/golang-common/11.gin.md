## 1. 安装依赖

```shell
go get -u github.com/gin-gonic/gin
```


## 2. 相关代码

### 2.1 启动和路由

```go
func InitServer() *gin.Engine {

	engine := gin.Default()
	InitRouter(engine)
	return engine
}

func InitRouter(engine *gin.Engine) {
	engine.GET("/whitelist", handlers.GetWhitelist)
}

func GetWhitelist(ctx *gin.Context) {
	result := whitelist.RenderWhiteRule()
	ctx.String(200, result)

}
```

### 2.2 单元测试

```go
package handlers

import (
	"net/http"
	"net/http/httptest"
	"net/url"
	"testing"

	"github.com/gin-gonic/gin"
)

func GetTestGinContext() *gin.Context {
	gin.SetMode(gin.TestMode)

	w := httptest.NewRecorder()
	ctx, _ := gin.CreateTestContext(w)
	ctx.Request = &http.Request{
		Header: make(http.Header),
		URL:    &url.URL{},
	}

	return ctx
}

// mock GET request
func MockJSONGet(c *gin.Context) {
	c.Request.Method = "GET"
	c.Request.Header.Set("Content-Type", "application/json")
	c.Set("user_id", 1)

	// set query params
	u := url.Values{}
	u.Add("skip", "5")
	u.Add("limit", "10")
	c.Request.URL.RawQuery = u.Encode()
}

func TestGetWhitelist(t *testing.T) {

	type args struct {
		ctx *gin.Context
	}
	tests := []struct {
		name string
		args args
	}{
		{
			name: "testGetWhitelist",
			args: args{
				ctx: GetTestGinContext(),
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			GetWhitelist(tt.args.ctx)
		})
	}
}

```