## 1. 安装依赖
```shell
go get -u github.com/segmentio/kafka-go
```

## 2. 相关代码

```go
package consumers

import (
	"context"
	"pac-auto/internal/checker/service"
	"pac-auto/internal/clash-monitor/config"
	"pac-auto/internal/clash-monitor/consumers/instance"

	"github.com/segmentio/kafka-go"
	log "github.com/sirupsen/logrus"
)

var (
	consumerMap = map[string]Consumer{
		"clash-log":     &instance.ClashLogConsumer{},
		"clash-audit":   &instance.ClashAuditConsumer{},
		"clash-traffic": &instance.ClashTrafficConsumer{},
	}
)

func InitConsumer(kafkaConfig config.KafkaConfig) {

	for index := range kafkaConfig.Consumer {
		if c, ok := getConsumer(kafkaConfig.Consumer[index].ConsumerName); ok {
			consumerConfig := kafkaConfig.Consumer[index]
			errChan := make(chan error, 20)
			go func() {
				log.Infof("consumer %s start", consumerConfig.ConsumerName)
				reader := createReader(kafkaConfig.URL, consumerConfig)
				for {
					m, err := reader.ReadMessage(context.Background())
					if err != nil {
						panic(err)
					}
					go c.Consumer(m, errChan)
				}
			}()
			go func() {
				for msgErr := range errChan {
					log.Errorf("consumer %s error: %s", kafkaConfig.Consumer[index].ConsumerName, msgErr.Error())
					alarmService := service.AlarmService{}
					alarmService.SendAlarm("consumer error", msgErr.Error(), consumerConfig.ConsumerName+"日志解析失败")
				}
			}()
		} else {
			log.Warnf("consumer %s not found", kafkaConfig.Consumer[index].ConsumerName)
		}
	}
}

func createReader(host []string, consumerConfig config.KafkaConsumerConfig) *kafka.Reader {
	return kafka.NewReader(kafka.ReaderConfig{
		Brokers:  host,
		Topic:    consumerConfig.Topic,
		GroupID:  consumerConfig.Group,
		MinBytes: 10e3, // 10KB
		MaxBytes: 10e6, // 10MB
	})
}

func getConsumer(name string) (Consumer, bool) {
	c, ok := consumerMap[name]
	return c, ok
}
```